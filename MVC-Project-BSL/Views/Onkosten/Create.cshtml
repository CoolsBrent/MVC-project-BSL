@model MVC_Project_BSL.Models.Onkosten

@{
    var userType = User.IsInRole("Hoofdmonitor") ? "Hoofdmonitor" : "Verantwoordelijke"; // Dynamisch de gebruiker bepalen
    var resterendBudget = ViewBag.ResterendBudget ?? 0;  // Haal het resterende budget op uit de ViewBag

    var groepsreisNaam = ViewBag.GroepsreisNaam ?? "Onbekende Groepsreis";
}


<h1>Onkosten voor @groepsreisNaam</h1>
<h5>Resterend Budget: @string.Format("{0:F2}", resterendBudget)€</h5>

<!-- Controleer of het resterende budget groter dan 0 is -->
@if (resterendBudget > 0)
{
    <form asp-action="Create" method="post" enctype="multipart/form-data" id="onkostenForm">
        <div class="form-group">
            <label asp-for="Titel" class="control-label"></label>
            <input asp-for="Titel" class="form-control autocomplete" />
            <span asp-validation-for="Titel" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Omschrijving" class="control-label"></label>
            <textarea asp-for="Omschrijving" class="form-control"></textarea>
            <span asp-validation-for="Omschrijving" class="text-danger"></span>
        </div>

       

        <div class="form-group">
            <label asp-for="Bedrag" class="control-label"></label>
            <input asp-for="Bedrag" class="form-control" id="Bedrag" />
            <span asp-validation-for="Bedrag" class="text-danger"></span>
        </div>
        <!-- Waarschuwing voor het bedragveld (standaard verborgen) -->
        <div class="form-group" id="budgetWarning" style="display: none;">
            <div class="text-danger">
                Het ingevoerde bedrag is groter dan het resterende budget. Pas het bedrag aan.
            </div>
        </div>
        <div class="form-group">
            <label asp-for="Datum" class="control-label"></label>
            <input asp-for="Datum" class="form-control" type="date" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
            <span asp-validation-for="Datum" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="FotoFile" class="control-label"></label>
            <input asp-for="FotoFile" type="file" class="form-control" />
            <span asp-validation-for="FotoFile" class="text-danger"></span>
        </div>

        <!-- Gebruik asp-for voor GroepsreisId -->
        <input type="hidden" asp-for="GroepsreisId" />
        <!-- Verborgen veld voor het Type op basis van de rol van de gebruiker -->
        <input type="hidden" asp-for="TypeOnkost" value="@userType" />

        <button type="submit" class="btn btn-primary mt-4">Opslaan</button>
    </form>
}
else
{
    <p class="text-danger">Het budget is bereikt. Geen onkosten kunnen meer worden toegevoegd.</p>
}

<a asp-controller="Onkosten" asp-action="Index" asp-route-groepsreisId="@Model.GroepsreisId" class="btn btn-secondary mt-2">Annuleren</a>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")
    <script>
        // JavaScript-validatie voor het bedrag wanneer het formulier wordt ingediend
        document.getElementById("onkostenForm").addEventListener("submit", function (event) {
            var resterendBudget = @resterendBudget; // Haal het resterende budget op van de server-side code
            var bedragInput = document.getElementById("Bedrag");
            var bedrag = parseFloat(bedragInput.value);

            // Controleer of het bedrag groter is dan het resterende budget
            if (bedrag > resterendBudget) {
                event.preventDefault(); // Voorkom het verzenden van het formulier
                document.getElementById("budgetWarning").style.display = "block"; // Toon de waarschuwing
            } else {
                document.getElementById("budgetWarning").style.display = "none"; // Verberg de waarschuwing als het bedrag in orde is
            }
        });
    </script>
}
