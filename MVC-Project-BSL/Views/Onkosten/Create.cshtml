@model MVC_Project_BSL.Models.Onkosten

@{
    ViewData["Title"] = "Nieuwe Onkosten Toevoegen";
}

<h1>@ViewData["Title"]</h1>

<h3>Onkosten voor Groepsreis: @ViewBag.GroepsreisId</h3>

<form asp-action="Create" method="post" enctype="multipart/form-data">
    <div class="form-group">
        <label asp-for="Titel" class="control-label"></label>
        <input asp-for="Titel" class="form-control autocomplete" />
        <span asp-validation-for="Titel" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Omschrijving" class="control-label"></label>
        <textarea asp-for="Omschrijving" class="form-control"></textarea>
        <span asp-validation-for="Omschrijving" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Bedrag" class="control-label"></label>
        <input asp-for="Bedrag" class="form-control" />
        <span asp-validation-for="Bedrag" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Datum" class="control-label"></label>
        <input asp-for="Datum" class="form-control" type="date" value="@DateTime.Now.ToString("dd-MM-yyyy")" />
        <span asp-validation-for="Datum" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="FotoFile" class="control-label"></label>
        <input asp-for="FotoFile" type="file" class="form-control" />
        <span asp-validation-for="FotoFile" class="text-danger"></span>
    </div>

    <!-- Gebruik asp-for voor GroepsreisId -->
    <input type="hidden" asp-for="GroepsreisId" />

    <button type="submit" class="btn btn-primary">Opslaan</button>
</form>

<a asp-controller="Onkosten" asp-action="Index" asp-route-groepsreisId="@Model.GroepsreisId" class="btn btn-secondary">Annuleren</a>
@section Scripts {
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />

    @await Html.PartialAsync("_ValidationScriptsPartial")

    <script>
        $(document).ready(function () {
           

            // Functie voor autocomplete
            function initializeAutocomplete() {
                $('.autocomplete').autocomplete({
                    source: function (request, response) {
                        $.ajax({
                            url: '@Url.Action("GetOnkosten", "Onkosten")', // De actie in je controller
                            dataType: "json",
                            data: {
                                term: request.term // De zoekterm die je invoert
                            },
                            success: function (data) {
                                response(data); // Geef de zoekresultaten terug
                            },
                            error: function () {
                                response([]); // Lege lijst teruggeven bij fout
                            }
                        });
                    },
                    minLength: 0, // Start zoekopdracht zonder minimaal aantal tekens
                    select: function (event, ui) {
                        $(this).val(ui.item.value); // Vul het tekstveld met de geselecteerde waarde
                        return false; // Voorkom dat het automatisch invult bij hover
                    }
                });

                // Trigger autocomplete direct als je op het tekstvak klikt (zonder zoekterm)
                $(document).on('focus', '.autocomplete', function () {
                    $(this).autocomplete("search", ""); // Start de zoekfunctie met een lege zoekterm
                });
            }

            // Initialiseer autocomplete voor alle velden
            initializeAutocomplete();
        });
    </script>
    <script>
        $(document).ready(function () {
            // Stel de waarde van het datumveld in op de huidige datum
            var today = new Date().toISOString().split('T')[0]; // Huidige datum in formaat YYYY-MM-DD
            $('input[type="date"]').val(today); // Zet de waarde van alle date-inputvelden
        });
    </script>
}