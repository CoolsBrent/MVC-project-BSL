@using System.Globalization
@model MVC_Project_BSL.Models.Groepsreis

<h1>De reis naar @Model.Bestemming?.BestemmingsNaam</h1>

<!-- Foto en beschrijving naast elkaar -->
<div class="row">
    <!-- Linkerzijde: Foto's (50% breedte) -->
    <div class="col-md-6">
        @if (Model.Bestemming?.Fotos != null && Model.Bestemming.Fotos.Any())
        {
            <div class="row">
                @foreach (var foto in Model.Bestemming.Fotos)
                {
                    <div class="col-12 mb-3">
                        <img src="~/images/@foto.Naam" alt="Foto van @Model.Bestemming.BestemmingsNaam" class="large-thumbnail img-thumbnail img-fluid" />
                    </div>
                }
            </div>
        }
        else
        {
            <p>Geen foto's beschikbaar</p>
        }
    </div>

    <!-- Rechterzijde: Beschrijving (50% breedte) -->
    <div class="col-md-6 d-flex flex-column">
        <h2>@Model.Bestemming?.BestemmingsNaam</h2>
        <p>@Model.Bestemming?.Beschrijving</p>

        <h5>Activiteiten</h5>
        @if (Model.Programmas != null && Model.Programmas.Any())
        {
            <ul>
                @foreach (var activiteit in Model.Programmas)
                {
                    <li>
                        <strong>@activiteit.Activiteit.Naam</strong>: @activiteit.Activiteit.Beschrijving
                    </li>
                }
            </ul>
        }
        else
        {
            <p>Nog geen activiteiten beschikbaar voor deze reis.</p>
        }

        @if (User.IsInRole("Beheerder") || User.IsInRole("Verantwoordelijke"))
        {
            <a asp-controller="Onkosten" asp-action="Index" asp-route-groepsreisId="@Model.Id" class="btn btn-secondary mt-4">
                Onkosten Beheren
            </a>
        }
        @if (User.IsInRole("Hoofdmonitor"))
        {
            <a asp-controller="Onkosten" asp-action="Create" asp-route-groepsreisId="@Model.Id" class="btn btn-secondary mt-4">
                Onkost ingeven
            </a>
        }
    </div>
</div>

<hr />

<div class="row">
    <!-- Details van de groepsreis -->
    <div class="col-md-6">
        <h4>Details</h4>
        <dl class="row">
            <dt class="col-sm-4">Begindatum</dt>
            <dd class="col-sm-8">@Model.Begindatum.ToString("dd-MM-yyyy")</dd>

            <dt class="col-sm-4">Einddatum</dt>
            <dd class="col-sm-8">@Model.Einddatum.ToString("dd-MM-yyyy")</dd>

            <dt class="col-sm-4">Prijs</dt>
            <dd class="col-sm-8">@Model.Prijs.ToString("C", new CultureInfo("nl-BE"))</dd>

            <dt class="col-sm-4">Leeftijdscategorie</dt>
            <dd class="col-sm-8">@Model.Bestemming?.MinLeeftijd - @Model.Bestemming?.MaxLeeftijd</dd>

            <dt class="col-sm-4">Aantal deelnemers</dt>
            <dd class="col-sm-8">@Model.Deelnemers.Count() / @Model.MaxAantalDeelnemers</dd>
        </dl>
    </div>
</div>

<hr />

<!-- Wachtlijst -->
<div class="row mt-5">
    <div class="col-md-12">
        <h4>Wachtlijst</h4>
        @if (Model.Wachtlijst != null && Model.Wachtlijst.Any())
        {
            <table class="table">
                <thead>
                    <tr>
                        <th>Naam</th>
                        <th>Leeftijd</th>
                        <th>Acties</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var deelnemer in Model.Wachtlijst)
                    {
                        var geboortedatum = deelnemer.Kind.Geboortedatum;
                        var leeftijd = DateTime.Now.Year - geboortedatum.Year;
                        if (DateTime.Now < geboortedatum.AddYears(leeftijd)) leeftijd--;

                        <tr>
                            <td>@deelnemer.Kind.Voornaam @deelnemer.Kind.Naam</td>
                            <td>@leeftijd jaar</td>
                            <td>
                                <div class="d-flex gap-2">
                                    <form asp-action="VerwijderUitWachtlijst" method="post">
                                        <input type="hidden" name="groepsreisId" value="@Model.Id" />
                                        <input type="hidden" name="kindId" value="@deelnemer.Kind.Id" />
                                        <button type="submit" class="btn btn-danger btn-sm">Verwijder</button>
                                    </form>
                                    <button class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#verplaatsModal-@deelnemer.Kind.Id">Verplaats</button>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            <p>Er staan momenteel geen deelnemers op de wachtlijst.</p>
        }
    </div>
</div>

<!-- Modal voor verplaatsing in de wachtlijst -->
@foreach (var deelnemer in Model.Wachtlijst)
{
    <div class="modal fade" id="verplaatsModal-@deelnemer.Kind.Id" tabindex="-1" aria-labelledby="verplaatsModalLabel-@deelnemer.Kind.Id" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="verplaatsModalLabel-@deelnemer.Kind.Id">Verplaats @deelnemer.Kind.Voornaam</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form asp-action="VerplaatsInWachtlijst" method="post">
                        <input type="hidden" name="groepsreisId" value="@Model.Id" />
                        <input type="hidden" name="kindId" value="@deelnemer.Kind.Id" />
                        <div class="mb-3">
                            <label for="nieuweIndex" class="form-label">Nieuwe positie</label>
                            <input type="number" class="form-control" id="nieuweIndex" name="nieuweIndex"
                                   min="0" max="@Model.Wachtlijst.Count - 1"
                                   value="@Model.Wachtlijst.ToList().IndexOf(deelnemer)" required />
                        </div>
                        <button type="submit" class="btn btn-primary">Verplaats</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
}
